!function(){function t(e,n,i){function s(a,l){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!l&&c)return c(a,!0);if(o)return o(a,!0);var r=new Error("Cannot find module '"+a+"'");throw r.code="MODULE_NOT_FOUND",r}var d=n[a]={exports:{}};e[a][0].call(d.exports,function(t){var n=e[a][1][t];return s(n||t)},d,d.exports,t,e,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)s(i[a]);return s}return t}()({1:[function(t,e,n){!function(){var t=angular.module("panel",[]),e=0,n=null;t.controller("modules",["$scope","$sce",function(t,e){t.options=parent.parent._modules[parent.modules_render.type].options,t.settings=jQuery.extend({},parent.modules_render.settings),t._category=parent.parent._category,t._product_cat=parent.parent._product_cat,t.toHtml=function(t){return e.trustAsHtml(t)};var n=angular.element(".wrap");n.append('<div class="clearfix submit-bar col-xs-offset-2 col-xs-9"><button type="button" class="button button-primary btn-submit">提 交</button><button type="button" class="button button-secondary btn-cancel">取 消</button></div>'),n.show(),n.on("click",".btn-submit",function(){"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(),angular.element(".wp-editor-area").each(function(e,n){var i=angular.element(n),s=i.closest(".mod-el-repeat");s.length&&void 0!==t.settings[s.data("key")]?t.settings[s.data("key")][s.data("index")][i.attr("name")]=i.val():t.settings[i.attr("name")]=i.val(),t.$apply()});var e={};for(var n in t.settings)n.match(/^___.*/)||(e[n]=t.settings[n]);t.settings=e,parent.updateModules({type:parent.modules_render.type,settings:angular.fromJson(angular.toJson(t.settings)),id:parent.modules_render.id}),angular.element(".wpcom-modal-close",parent.document).trigger("click")}),n.on("click",".btn-cancel",function(){angular.element(".wpcom-modal-close",parent.document).trigger("click")}).on("click",".mod-tab-item",function(){var t=angular.element(this);angular.element(".mod-tab-item").removeClass("active"),t.addClass("active"),angular.element(".mod-content").removeClass("active").eq(t.index()).addClass("active")})}]),t.directive("modItem",["$sce","$compile",function(t,e){return{restrict:"C",link:function(t,n){var i='<div class="meta-item clearfix mod-el-'+t.v.type+'"></div>';if("repeat"==t.v.type){if(!t.settings[t.k]){t.settings[t.k]=[];var s={};for(var o in t.v.items)s[o]=t.v.items[o].value;t.settings[t.k].push(s)}i='<div class="meta-item clearfix mod-el-'+t.v.type+'" ng-repeat="sts in settings[k]" settings="sts" data-index="{{$index}}" data-key="'+t.k+'"></div><div class="add-new-wrap"><button type="button" class="btn button button-secondary add-new-item"><i class="fa fa-plus"></i> 添加选项</button></div>',n.on("click",".add-new-item",function(){var e={};for(var n in t.v.items)e[n]=t.v.items[n].value;t.settings[t.k].push(e),t.$apply()})}n.html(i),e(n.contents())(t)}}}]),t.directive("modElText",function(){return{restrict:"C",link:function(t){t.settings[t.k]=void 0!==t.settings[t.k]?t.settings[t.k]:t.v.value},template:function(){return'<div class="clearfix"><div class="col-xs-2 control-label">{{v.name}}</div><div class="col-xs-9"><input type="text" class="form-control" ng-model="settings[k]" name="{{k}}" value="{{settings[k]}}" placeholder="{{v.place}}"></div><div class="col-xs-offset-2 col-xs-9" ng-show="v.desc"><p class="meta-desc" ng-bind-html="toHtml(v.desc)"></p></div></div>'}}}),t.directive("modElSelect",function(){return{restrict:"C",link:function(t){t.settings[t.k]=void 0!==t.settings[t.k]?t.settings[t.k]:t.v.value},template:function(){return'<div class="clearfix"><div class="col-xs-2 control-label">{{v.name}}</div><div class="col-xs-9"><select class="form-control" ng-model="settings[k]" name="{{k}}" ng-options="k as v for (k, v) in v.options"><option value="">--请选择--</option></select></div><div class="col-xs-offset-2 col-xs-9" ng-show="v.desc"><p class="meta-desc" ng-bind-html="toHtml(v.desc)"></p></div></div>'}}}),t.directive("modElCheckbox",function(){return{restrict:"C",link:function(t){if(t._k="___"+t.k,t.settings[t.k]=void 0!==t.settings[t.k]?t.settings[t.k]:[],t.settings[t._k]=void 0!==t.settings[t._k]?t.settings[t._k]:[],"string"==typeof t.v.options&&void 0!==t[t.v.options]){for(var e={},n=0;n<t[t.v.options].length;n++)e[t[t.v.options][n].id]=t[t.v.options][n].name;t.v.options=e}var i=0;for(var s in t.v.options)t.settings[t.k].indexOf(s)>-1?t.settings[t._k][i]=s:t.settings[t._k][i]=null,i++;t.change=function(e){var n=[];for(var i in t.settings[t._k])null!==t.settings[t._k][i]&&n.indexOf(t.settings[t._k][i])<0&&n.push(t.settings[t._k][i]);t.settings[t.k]=n}},template:function(){return'<div class="clearfix"><div class="col-xs-2 control-label">{{v.name}}</div><div class="col-xs-9"> <label class="checkbox-item" ng-repeat="(key, val) in v.options track by $index"><input type="checkbox" ng-model="settings[_k][$index]" name="{{k}}[]" ng-true-value="\'{{key}}\'" ng-false-value="null" ng-change="change();">{{val}}</label></div><div class="col-xs-offset-2 col-xs-9" ng-show="v.desc"><p class="meta-desc" ng-bind-html="toHtml(v.desc)"></p></div></div>'}}}),t.directive("modElCheckboxSort",function(){return{restrict:"C",link:function(t){if(t.settings[t.k]=void 0!==t.settings[t.k]?t.settings[t.k]:[],"string"==typeof t.v.options&&void 0!==t[t.v.options]){for(var e={},n=0;n<t[t.v.options].length;n++)e[t[t.v.options][n].id]=t[t.v.options][n].name;t.v.options=e}var i=Object.keys(t.v.options),s=$.extend([],t.settings[t.k]);for(var n in i)s.indexOf(i[n])<0&&s.push(i[n]);t._keys=s;var o=(new Date).valueOf();t.change=function(e){if(!((new Date).valueOf()-o<10)){o=(new Date).valueOf();var n=$.extend([],t.settings[t.k]);n.indexOf(e.key)<0?n.push(e.key):n.splice(n.indexOf(e.key),1),t.settings[t.k]=n;var i=$.extend([],n);for(var s in t._keys)i.indexOf(t._keys[s])<0&&i.push(t._keys[s]);t._keys=i,setTimeout(function(){$('[name="'+t.k+'"]').each(function(e,n){t.settings[t.k].indexOf($(n).val())>-1?$(n).prop("checked",!0):$(n).prop("checked",!1)})},5)}}},template:function(){return'<div class="clearfix"><div class="col-xs-2 control-label">{{v.name}}</div><div class="col-xs-9" id="j-{{k}}"> <label class="checkbox-item" ng-repeat="key in _keys track by $index" ng-click="change(this)"><input type="checkbox" value="{{key}}" name="{{k}}" ng-checked="settings[k].indexOf(key)>-1">{{v.options[key]}}</label></div><div class="col-xs-offset-2 col-xs-9" ng-show="v.desc"><p class="meta-desc" ng-bind-html="toHtml(v.desc)"></p></div></div>'}}}),t.directive("modElCat",function(){return{restrict:"C",link:function(t){t.settings[t.k]=void 0!==t.settings[t.k]?t.settings[t.k]:t.v.value},template:function(){return'<div class="clearfix"><div class="col-xs-2 control-label">{{v.name}}</div><div class="col-xs-9"><select class="form-control" ng-model="settings[k]" name="{{k}}" ng-options="c.id as c.name for c in _category"><option value="">--请选择--</option></select></div><div class="col-xs-offset-2 col-xs-9" ng-show="v.desc"><p class="meta-desc" ng-bind-html="toHtml(v.desc)"></p></div></div>'}}}),t.directive("modElWooCat",function(){return{restrict:"C",link:function(t){t.settings[t.k]=void 0!==t.settings[t.k]?t.settings[t.k]:t.v.value},template:function(){return'<div class="clearfix"><div class="col-xs-2 control-label">{{v.name}}</div><div class="col-xs-9"><select class="form-control" ng-model="settings[k]" name="{{k}}" ng-options="c.id as c.name for c in _product_cat"><option value="">--请选择--</option></select></div><div class="col-xs-offset-2 col-xs-9" ng-show="v.desc"><p class="meta-desc" ng-bind-html="toHtml(v.desc)"></p></div></div>'}}}),t.directive("modElToggle",function(){return{restrict:"C",link:function(t,e){var n=e.find(".toggle");n.on("click",function(){n.toggleClass("active"),t.settings[t.k]=n.hasClass("active")?1:0}),t.settings[t.k]=void 0!==t.settings[t.k]?t.settings[t.k]:t.v.value},template:function(){return'<div class="clearfix"><div class="col-xs-2 control-label">{{v.name}}</div><div class="col-xs-9"><div class="toggle" ng-class="{active:settings[k]==1}"></div><input type="hidden" ng-model="settings[k]" name="{{k}}" value="{{settings[k]}}"></div><div class="col-xs-offset-2 col-xs-9" ng-show="v.desc"><p class="meta-desc" ng-bind-html="toHtml(v.desc)"></p></div></div>'}}}),t.directive("modElTextarea",function(){return{restrict:"C",link:function(t){t.settings[t.k]=void 0!==t.settings[t.k]?t.settings[t.k]:t.v.value},template:function(){return'<div class="clearfix"><div class="col-xs-2 control-label">{{v.name}}</div><div class="col-xs-9"><textarea ng-model="settings[k]" name="{{k}}" rows="3" class="form-control">{{settings[k]}}</textarea></div><div class="col-xs-offset-2 col-xs-9" ng-show="v.desc"><p class="meta-desc" ng-bind-html="toHtml(v.desc)"></p></div></div>'}}}),t.directive("modElColor",function(){return{restrict:"C",link:function(t,e){t.settings[t.k]=void 0!==t.settings[t.k]?t.settings[t.k]:t.v.value;var n={defaultColor:t.v.value,change:function(e,n){t.settings[t.k]=n.color.toString()},clear:function(){t.settings[t.k]=""}};setTimeout(function(){e.find(".color-picker").wpColorPicker(n)},10)},template:function(){return'<div class="clearfix"><div class="col-xs-2 control-label">{{v.name}}</div><div class="col-xs-9"><input class="color-picker" type="text" ng-model="settings[k]" name="{{k}}" value="{{settings[k]}}"></div><div class="col-xs-offset-2 col-xs-9" ng-show="v.desc"><p class="meta-desc" ng-bind-html="toHtml(v.desc)"></p></div></div>'}}}),t.directive("modElUpload",function(){return{restrict:"C",link:function(t,e){t.settings[t.k]=void 0!==t.settings[t.k]?t.settings[t.k]:t.v.value,e.find(".upload").on("click",function(){var e,n=this;e?e.open():(e=parent.parent.wp.media.frames.file_frame=parent.parent.wp.media({title:"选择文件",button:{text:"选择文件"},multiple:!1}),e.on("select",function(){var i=e.state().get("selection").first().toJSON();angular.element(n).parent().parent().find(".upload-input").val(i.url),t.settings[t.k]=i.url}),e.open())})},template:function(){return'<div class="clearfix"><div class="col-xs-2 control-label">{{v.name}}</div><div class="col-xs-8"><input type="text" class="form-control upload-input" ng-model="settings[k]" name="{{k}}" value="{{settings[k]}}" placeholder="{{v.place}}"></div><div class="col-xs-2" style="padding-left: 0;"><a class="upload" href="javascript:;"><i class="fa fa-image"></i> 上传</a></div><div class="col-xs-offset-2 col-xs-9" ng-show="v.desc"><p class="meta-desc" ng-bind-html="toHtml(v.desc)"></p></div></div>'}}}),t.directive("modElEditor",function(){return{restrict:"C",link:function(t){t.settings[t.k]=void 0!==t.settings[t.k]?t.settings[t.k]:t.v.value},template:function(){return'<div class="clearfix"><div class="col-xs-2 control-label">{{v.name}}</div><div class="col-xs-9" mod-editor></div><div class="col-xs-offset-2 col-xs-9" ng-show="v.desc"><p class="meta-desc" ng-bind-html="toHtml(v.desc)"></p></div></div>'}}}),t.directive("modEditor",["$compile","$timeout",function(t,e){return{restrict:"A",link:function(n,i){n.settings[n.k]=void 0!==n.settings[n.k]?n.settings[n.k]:n.v.value,angular.element("#dashicons-css").length>1&&(i.find("#dashicons-css").remove(),i.find("#editor-buttons-css").remove());var s=n.k,o=angular.element(i).closest(".mod-el-repeat");o.length&&(s=s+"_"+o.data("index")),n.$watch("settings."+n.k,function(t){if("undefined"!=typeof tinymce&&tinymce.get(s)){tinymce.get(s).destroy();var e,n=tinyMCEPreInit.mceInit[s];e=tinymce.$("#wp-"+s+"-wrap"),!e.hasClass("tmce-active")&&tinyMCEPreInit.qtInit.hasOwnProperty(s)||n.wp_skip_init||(tinymce.init(n),window.wpActiveEditor||(window.wpActiveEditor=s)),"undefined"!=typeof quicktags&&(quicktags(tinyMCEPreInit.qtInit[s]),QTags._buttonsInit(),window.wpActiveEditor||(window.wpActiveEditor=s)),tinymce.get(s).setContent(t)}}),i.find("#wp-mod-editor-test-media-buttons").remove(),i.find("#wp-mod-editor-test-editor-tools").append('<div class="wp-media-buttons"><button type="button" class="button add_media mod-media"><span class="wp-media-buttons-icon"></span> 添加媒体</button></div>'),i.html(t(i.html().replace(/mod-editor-test/gi,s))(n)),tinyMCEPreInit.mceInit[s]=jQuery.extend({},tinyMCEPreInit.mceInit["mod-editor-test"]),tinyMCEPreInit.qtInit[s]=jQuery.extend({},tinyMCEPreInit.qtInit["mod-editor-test"]);for(var a in tinyMCEPreInit.mceInit[s])"string"==typeof tinyMCEPreInit.mceInit[s][a]&&(tinyMCEPreInit.mceInit[s][a]=tinyMCEPreInit.mceInit[s][a].replace(/mod-editor-test/gi,s));for(var a in tinyMCEPreInit.qtInit[s])"string"==typeof tinyMCEPreInit.qtInit[s][a]&&(tinyMCEPreInit.qtInit[s][a]=tinyMCEPreInit.qtInit[s][a].replace(/mod-editor-test/gi,s));e(function(){var t,e,n=s;"undefined"!=typeof tinymce&&(t=tinyMCEPreInit.mceInit[n],e=tinymce.$("#wp-"+n+"-wrap"),!e.hasClass("tmce-active")&&tinyMCEPreInit.qtInit.hasOwnProperty(n)||t.wp_skip_init||(tinymce.init(t),window.wpActiveEditor||(window.wpActiveEditor=n))),"undefined"!=typeof quicktags&&(quicktags(tinyMCEPreInit.qtInit[n]),QTags._buttonsInit(),window.wpActiveEditor||(window.wpActiveEditor=n))},10),i.find(".mod-media").on("click",function(){var t;t?t.open():(t=parent.parent.wp.media.frames.file_frame=parent.parent.wp.media({title:"选择文件",button:{text:"选择文件"},multiple:!1}),t.on("select",function(){var e=t.state().get("selection").first().toJSON(),n="";"image"==e.type&&(n='<img src="'+e.url+'" width="'+e.width+'" height="'+e.height+'" alt="'+(e.alt||e.title)+'">'),wp.media.editor.insert(n)}),t.open())})},template:function(){var t=angular.element("#j-tpl-editor").html();return t=t.replace('class="wp-editor-area"','class="wp-editor-area" ng-model="settings[k]" name="{{k}}"').replace('"></textarea>','">{{settings[k]}}</textarea>')}}}]),t.directive("modElColumns",function(){return{restrict:"C",link:function(t){var e=t.k+"_mobile";t.$parent.k_mobile=e,t.settings[t.k]&&t.settings[t.k].length?(t.settings[t.k]=t.settings[t.k],t.settings[e]&&t.settings[e].length?t.settings[e]=t.settings[e]:t.settings[e]=jQuery.extend(!0,[],t.settings[t.k])):(t.settings[t.k]=jQuery.extend(!0,[],t.v.value),t.settings[e]=jQuery.extend(!0,[],t.v.value));var n={2:["6","6"],3:["4","4","4"],4:["3","3","3","3"],5:["3","3","2","2","2"],6:["2","2","2","2","2","2"]},i=jQuery.extend(!0,{},n);t.cols=""+t.settings[t.k].length,n[t.cols]=t.settings[t.k],i[t.cols]=t.settings[e],t.$watch("cols",function(s){t.settings[t.k]=n[s],t.settings[e]=i[s]})},template:function(){return'<div class="clearfix"><div class="col-xs-2 control-label">{{v.name}}</div><div class="col-xs-9"><select class="form-control" ng-model="cols"><option value="2" ng-selected="cols==2">2列</option><option value="3" ng-selected="cols==3">3列</option><option value="4" ng-selected="cols==4">4列</option><option value="5" ng-selected="cols==5">5列</option><option value="6" ng-selected="cols==6">6列</option></select></div><div class="col-xs-offset-2 col-xs-9" ng-show="v.desc"><p class="meta-desc" ng-bind-html="toHtml(v.desc)"></p></div></div><div class="clearfix"><div class="col-xs-2 control-label girds-label">栅格设置#PC端</div><div class="col-xs-9 row girds-wrap"><div class="col-xs-2" ng-repeat="g in settings[k] track by $index"><input class="form-control" ng-model="settings[k][$index]" type="text"></div></div></div><div class="clearfix"><div class="col-xs-2 control-label girds-label">栅格设置#手机端</div><div class="col-xs-9 row girds-wrap"><div class="col-xs-2" ng-repeat="g in settings[k_mobile] track by $index"><input class="form-control" ng-model="settings[k_mobile][$index]" type="text"></div></div><div class="col-xs-offset-2 col-xs-9"><p class="meta-desc">如不需要显示可以设置为0，单独一行可以设置为12</p></div></div>'}}}),t.directive("modElRepeat",["$compile","$timeout",function(t,i){return{restrict:"C",scope:{settings:"="},link:function(s,o){s.options=s.$parent.v.items,s._category=s.$parent._category,s._product_cat=s.$parent._product_cat,s.toHtml=s.$parent.toHtml,s.repeatAction=function(t){var a=o.closest(".mod-el-repeat"),l=a.index(),c=a.data("key");if("up"==t){if(0==l)return}else if("down"==t){if(!a.next().hasClass("mod-el-repeat"))return}else if("del"==t)return void s.$parent.settings[c].splice(l,1);if(e){e=0;var r=jQuery.extend(!0,{},s.settings);s.$parent.settings[c][l]={},"up"==t?s.$parent.settings[c][l-1]={}:"down"==t&&(s.$parent.settings[c][l+1]={}),i(function(){s.$parent.settings[c][l]=n,"up"==t?s.$parent.settings[c][l-1]=r:"down"==t&&(s.$parent.settings[c][l+1]=r),s.$parent.$apply()},0)}else"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(),o.closest(".mod-el-repeat").closest(".mod-item").find(".wp-editor-area").each(function(t,e){var n=angular.element(e),i=n.closest(".mod-el-repeat"),o=i.data("key");void 0!==s.$parent.settings[o]&&(s.$parent.settings[o][i.data("index")][n.attr("name")]=n.val())}),n=jQuery.extend(!0,{},s.settings),e=1,i(function(){"up"==t?a.prev().find(".repeat-down").trigger("click"):"down"==t&&a.next().find(".repeat-up").trigger("click")},0)};o.html('<div class="mod-item" ng-repeat="(k, v) in options"></div><div class="repeat-action"><div class="repeat-item repeat-up" ng-click="repeatAction(\'up\')"><i class="fa fa-arrow-up"></i></div><div class="repeat-item repeat-down" ng-click="repeatAction(\'down\')"><i class="fa fa-arrow-down"></i></div><div class="repeat-item repeat-del" ng-click="repeatAction(\'del\')"><i class="fa fa-times"></i></div></div>'),t(o.contents())(s)}}}])}()},{}]},{},[1]);